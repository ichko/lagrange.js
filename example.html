<html>
    <head>
        <meta charset="utf-8">
        <title>Example</title>

        <style>*{padding: 0;margin: 0}</style>
    </head>
    <body>
        <canvas id="canvas"></canvas>

        <script src="event.js"></script>
        <script src="plotter.js"></script>
        <script src="io.js"></script>
        <script src="lagrange.js"></script>
        
        <script>

            let [ canvas, ctx, width, height ] = ((canvasId) => {
                let canvas = document.getElementById(canvasId);
                [ canvas.width, canvas.height ] = [ innerWidth, innerHeight ];

                let ctx = canvas.getContext('2d');
                ctx.translate(canvas.width / 2, canvas.height / 2);

                return [ canvas, ctx, canvas.width, canvas.height ];
            })('canvas');

            let plotter = new Plotter(ctx),
                io = new IO(),
                lagrange = new Lagrange(plotter.points),
                event = new Event(),
                translate = ({ x, y }) => ({
                    x: (x - width / 2) / plotter.config.scale,
                    y: (-y + height / 2) / plotter.config.scale
                });

            event.create('hover', ({ x, y }, mouse) => {
                let [ dx, dy ] = [ x - mouse.x, y - mouse.y ];
                return Math.sqrt(dx * dx + dy * dy) < 10 / plotter.config.scale;
            }, () => translate(io.mouse));

            event.attach.hover.to(plotter.points,
                (point) => point.style = { color: 'red' },
                (point) => point.style = { color: 'blue' }
            );

            io
                .onKey('+', () => plotter.config.scale *= 1.1)
                .onKey('-', () => plotter.config.scale /= 1.1)
                .onMouse('scroll', (direction) => plotter.config.scale *= 1.2 ** direction)
                .onMouse('click', (point) => {
                    plotter.addPoint(translate(point));
                    lagrange.build();
                });
                
            
            plotter.addFunctionBuilders([lagrange.getBuilder(), () => Math.sin]);

            (function draw() {
                event.invokeHandlers();
                io.invokeHandlers();
                plotter
                    .clear(width, height)
                    .show();

                requestAnimationFrame(draw);
            })();

        </script>
    </body>
</html>